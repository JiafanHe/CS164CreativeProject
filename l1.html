<html>
  <head>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://mixedreality.mozilla.org/ammo.js/builds/ammo.wasm.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/n5ro/aframe-physics-system@v4.0.1/dist/aframe-physics-system.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/aframe-template-component@^3.1.1/dist/aframe-template-component.min.js"></script> 
    <script src="follow.js"></script>
    <script src="scorekeeper.js"></script>

  </head>
  <body>
    <!--
        We use the Ammo Physics system here.
        https://github.com/n5ro/aframe-physics-system/blob/HEAD/AmmoDriver.md#ammo-body       
    -->
  <a-scene physics="driver: ammo; debug: false; debugDrawMode: 1;">

    <a-assets>
        <a-mixin id="wall"         
                  material="src:wood.jpg;  repeat:40 4"       
        ></a-mixin>
        <img id="nightsky"
             src="https://cdn.glitch.com/9baeb756-4dfe-40ae-a61f-52b72510282b%2Fnightsky.png?v=1603277760890">
    </a-assets>

    <a-entity template="src: #boxTemplate"></a-entity>

    <a-sky src="#nightsky"></a-sky>

    <!-- Floor -->
    <a-box id="floor"
        ammo-body="type:static;" ammo-shape="type:box"
        width="100" height="100" depth="1"
        rotation="-90 0 0" position="0 0 0" 
        material="src:seamless_brick-512x512.png; repeat:40 40"
    ></a-box>

    <!-- <a-box
      id="exit" 
      width="5" height="5" depth="5"
      follow="target:#avatar; speed:3; url:l1.html; dist:5"
      ammo-body="type:kinematic" ammo-shape="type:box"
      material="src:wood.jpg; color:red;  repeat:1 1"  
      position="-50 2.5 -50">
    </a-box> -->

    <a-entity
      id="exitNPC"
      gltf-model="npc.gltf"
      animation-mixer="clip:jump"
      follow="target:#sphere; speed:10; url:l1.html; dist:10"
      position="-50 0 -50"
      scale="5 5 5"
      rotation="0 45 0"
    ></a-entity>

   
    <!-- walls are defined with mixins but ammo-body,ammo-shape
         can not be in the mixin ...
    -->

    <a-entity id='northwall' mixin="wall" 
              geometry="width:96; height:10; depth:1"
              ammo-body="type:kinematic;" ammo-shape="type:box"
              collideConnected="true"
              position="2 5 -50"></a-entity>
    <a-entity id='southwall' mixin="wall" 
              geometry="primitive:box;width:100; height:10; depth:1"
              ammo-body="type:kinematic;" ammo-shape="type:box"
              collideConnected="true"
              position="0 5 50"></a-entity>
    <a-entity id='eastwall' mixin="wall" 
              geometry="primitive:box;width:100; height:10; depth:1"
              ammo-body="type:kinematic;" ammo-shape="type:box"
              collideConnected="true"
              rotation="0 90 0"
              position="50 5 0"></a-entity>
    <a-entity id='westwall' mixin="wall" 
              geometry="primitive:box;width:96; height:10; depth:1"
              ammo-body="type:kinematic;" ammo-shape="type:box"
              collideConnected="true"
              rotation="0 90 0"
              position="-50 5 2"></a-entity>



    <a-entity id='wall1' mixin="wall" geometry="primitive:box;width:20; height:10; depth:5" 
              ammo-body="type:kinematic;" ammo-shape="type:box"
              collideConnected="true"
              position="-40 5 -30"
              ></a-entity>
    
    <a-entity id='wall2' mixin="wall" geometry="primitive:box;width:40; height:10; depth:5"
              ammo-body="type:kinematic;" ammo-shape="type:box"
              collideConnected="true"
              position="-10 5 -30"
              rotation="0 90 0"
    ></a-entity>

    <a-entity id='wall3' mixin="wall" geometry="primitive:box;width:40; height:10; depth:5"
        ammo-body="type:kinematic;" ammo-shape="type:box"
        collideConnected="true"
        position="30 5 -30"
    ></a-entity>

    <a-entity id='wall4' mixin="wall" geometry="primitive:box;width:40; height:10; depth:5"
        ammo-body="type:kinematic;" ammo-shape="type:box"
        collideConnected="true"
        position="-30 5 10"
        rotation="0 90 0"
    ></a-entity>

    <a-entity id='wall5' mixin="wall" geometry="primitive:box;width:40; height:10; depth:5"
        ammo-body="type:kinematic;" ammo-shape="type:box"
        collideConnected="true"   
        position="-10 5 10"
    ></a-entity>

    <a-entity id='wall6' mixin="wall" geometry="primitive:box;width:20; height:10; depth:5"
      ammo-body="type:kinematic;" ammo-shape="type:box"
      collideConnected="true"
      position="10 5 0"
      rotation="0 90 0"
    ></a-entity>

    <a-entity id='wall7' mixin="wall" geometry="primitive:box;width:20; height:10; depth:5"
      ammo-body="type:kinematic;" ammo-shape="type:box"
      collideConnected="true"
      position="30 5 0"
      rotation="0 90 0"
    ></a-entity>
    
    <a-entity id='wall8' mixin="wall" geometry="primitive:box;width:20; height:10; depth:5"
      ammo-body="type:kinematic;" ammo-shape="type:box"
      collideConnected="true"
      position="40 5 10"
    ></a-entity>

    <a-entity id='wall9' mixin="wall" geometry="primitive:box;width:40; height:10; depth:5"
      ammo-body="type:kinematic;" ammo-shape="type:box"
      collideConnected="true"
      position="-10 5 30"
      rotation="0 90 0"
    ></a-entity>

    <a-entity id='wall10' mixin="wall" geometry="primitive:box;width:20; height:10; depth:5"
      ammo-body="type:kinematic;" ammo-shape="type:box"
      collideConnected="true"
      position="10 5 40"
      rotation="0 90 0"
    ></a-entity>

    <a-entity id='wall11' mixin="wall" geometry="primitive:box;width:20; height:10; depth:5"
      ammo-body="type:kinematic;" ammo-shape="type:box"
      collideConnected="true"
      position="20 5 30"
    ></a-entity>
    
      
      <!-- avatar -->
    <a-entity  id="avatar" 
            movement-controls="fly:false" 
            scorekeeper="timeleft:60; winscore:35"
            look-controls="pointerLockEnabled:false"
            wasd-controls>
        <a-box 
            ammo-body="type:kinematic;"  ammo-shape="type:box"
            material="color:blue; opacity:0.5"
            position="0 0 0" width="3" height="1" depth="10"></a-box>
        <a-entity 
            camera position="0 1.6 0"
             ></a-entity>
        <a-entity id="hud"
             health="10"
             score="0"
             text="width:3; value: Start Game!;"
             position="0.75 2 -3"
        ></a-entity>
    </a-entity>

    <a-sphere
        id="sphere"
        material="src:wood.jpg; color:orange"
        position="0 1 -0"

        ammo-body="type: dynamic; mass: 2;linearDamping: 0.1" ammo-shape="type: sphere"
        radius="2"
    ></a-sphere>

    
  
  </a-scene>
  </body>
  </html>